{% extends 'base.html' %}
{% block content %}

<h1>{{ firstname }}'s Profile</h1>

<div>
    <h1>GRAPH!!!</h1>
    <canvas id="overall_progress_chart" width="400" height="400"></canvas>
</div>

{% if users_current_challenges|length >= 1 %}
    <div id="current_challenges">
    {% if users_current_challenges|length == 1 %}
        <h4>Current Challenge</h4>
    {% else %}
        <h4>Current Challenges</h4>
     {% endif %}

        {% for challenge in users_current_challenges %}
                <p>I will substitute {{ challenge[0] }} {{ challenge[1] }} for {{ challenge[2] }} 
                and use the ${{ "%0.2f" % challenge[4] }} I save to {{ challenge[3] }}.</p>
                <input type="button" value="View Challenge" class="view_button"
                data-acid="{{ challenge[6] }}">
                <input type="button" value="Cancel Challenge" class="cancel_button"
                data-acid="{{ challenge[6] }}">
        {% endfor %}
    </div>
{% endif %}

{% if users_completed_challenges|length >= 1 %}
    <div id="completed_challenges">
    {% if users_completed_challenges|length == 1 %}
        <h4>Completed Challenge</h4>
    {% else %}
        <h4>Completed Challenges</h4>
     {% endif %}

        {% for challenge in users_completed_challenges %}
            <p>I will substitute {{ challenge[0] }} {{ challenge[1] }} for {{ challenge[2] }} 
                and use the ${{ "%0.2f" % challenge[4] }} I save to {{ challenge[3] }}.</p>
            <input type="button" value="View Challenge" class="view_button"
            data-acid="{{ challenge[6] }}">
        {% endfor %} 
    </div>
{% endif %}

<script>

    $(".view_button").click(viewChallenge);

    function viewChallenge(evt) {
        var data = $(evt.currentTarget).data();
        var form = document.createElement('form');
        $(form).attr("action", "/view_challenge");
        $("<input>").attr({
                name: "ac_id",
                value: data.acid
            }).appendTo(form);
        $(form).submit();
    }

    $(".cancel_button").click(cancelChallenge);

    function cancelChallenge(evt) {
        var data = $(evt.currentTarget).data();
        var form = document.createElement('form');
        $(form).attr("action", "/cancel_challenge");
        $("<input>").attr({
                name: "ac_id",
                value: data.acid
            }).appendTo(form);
        $(form).submit();
    }

    $.get("/overall_progress_chart<{{ user_id }}",
        function (result) {
            ;
        }
    );

    var ctx = $("#overall_progress_chart").get(0).getContext("2d");
    
    var data = {
    labels: ["January", "February", "March", "April", "May", "June", "July"],
    datasets: [
        {
            label: "My First dataset",
            fillColor: "rgba(220,220,220,0.2)",
            strokeColor: "rgba(220,220,220,1)",
            pointColor: "rgba(220,220,220,1)",
            pointStrokeColor: "#fff",
            pointHighlightFill: "#fff",
            pointHighlightStroke: "rgba(220,220,220,1)",
            data: [65, 59, 80, 81, 56, 55, 40]
        },
        {
            label: "My Second dataset",
            fillColor: "rgba(151,187,205,0.2)",
            strokeColor: "rgba(151,187,205,1)",
            pointColor: "rgba(151,187,205,1)",
            pointStrokeColor: "#fff",
            pointHighlightFill: "#fff",
            pointHighlightStroke: "rgba(151,187,205,1)",
            data: [28, 48, 40, 19, 86, 27, 90]
        }
    ]
};
var overall_progress_chart = new Chart(ctx).Line(data);
</script>


{% endblock %}